(window.webpackJsonp=window.webpackJsonp||[]).push([["photo-list"],{"0379":function(t,e,a){},"27d9":function(t,e,a){"use strict";a.r(e);a("dbb3"),a("fe59"),a("ea69"),a("053b"),a("e18c"),a("08ba");var o=a("c451"),i={props:{photoUpdateData:{type:Object,default:function(){}}},data:function(){var t=this;return{loading:!1,isSwitch:"no",formValidate:{name:"",dateRange:[],pass:"",type_id:"",city:[],address:"",desc:""},ruleValidate:{name:[{required:!0,message:"请填写相册名称",trigger:"blur"}],city:[{required:!0,type:"array",min:2,message:"请选择举办城市",trigger:"change"},{type:"array",max:3,message:"请选择举办城市",trigger:"change"}],password:[{validator:function(e,a,o){"yes"==t.isSwitch?""==a?o(new Error("请输入相册密码")):a.length<4&&o(new Error("密码最少输入4位")):o()},trigger:"blur"}],type_id:[{required:!0,message:"请选择活动类型",trigger:"change"}],address:[{required:!0,message:"请填写详细地址",trigger:"blur"}],dateRange:[{required:!0,type:"array",message:"请选择起止日期",trigger:"change",fields:{0:{type:"date",required:!0,message:"请选择起止日期"},1:{type:"date",required:!0,message:"请选择起止日期"}}}],desc:[{required:!0,message:"请填写活动介绍",trigger:"blur"},{type:"string",min:20,message:"最少填写20个字符",trigger:"blur"}]},activityType:[],cityJson:[]}},watch:{photoUpdateData:function(t){if(t.id){for(var e in this.formValidate)"dateRange"==e?this.$set(this.formValidate,e,[t.starttime,t.endtime]):"city"==e?(this.formValidate[e].push(String(t.province_id)),this.formValidate[e].push(String(t.city_id)),this.formValidate[e].push(String(t.area_id))):this.formValidate[e]=t[e];this.formValidate.id=t.id}else this.formValidate=t;0==this.activityType.length&&this.getPhotoliveType()}},computed:{},methods:{handleSubmit:function(t){var e=this;this.$refs[t].validate((function(t){t?(e.loading=!0,e.createUpdateActions()):e.$Message.error("Fail!")}))},handleReset:function(t){this.$refs[t].resetFields()},changeStatusEvent:function(t){"no"==t&&(this.formValidate.pass="")},setTimeEvent:function(t){this.formValidate.starttime=t[0],this.formValidate.endtime=t[1]},getPhotoliveType:function(){var t=this;this.$req.photoliveType({},{loading:!1}).then((function(e){1e5==e.code?t.activityType=e.data:t.$Message.error(e.message),t.getCityJson()})).catch((function(e){console.log(e),t.$Message.error("系统异常")}))},getCityJson:function(){var t=this;0==this.cityJson.length&&this.$req.getCitys().then((function(e){t.cityJson=e}))},createUpdateActions:function(){var t=this;this.$req.photoliveCreateUpdate(this.jsonFormat(),{loading:!1}).then((function(e){t.loading=!1,1e5==e.code?(t.$emit("setNameEvent","isShowPhotoUpdate",!1),t.$emit("getPhotoList"),t.$Message.success(e.message)):t.$Message.error(e.message)})).catch((function(e){t.loading=!1,console.log(e),t.$Message.error("系统异常")}))},jsonFormat:function(){var t={};for(var e in this.formValidate)"city"==e?(t.province_id=this.formValidate[e][0],t.city_id=this.formValidate[e][1],t.area_id=this.formValidate[e][2]):t[e]=String(this.formValidate[e]);return t.u_id=this.$userinfo.id,t}},created:function(){}},s=(a("a9bf"),a("e90a")),r=Object(s.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{attrs:{"dis-hover":"",bordered:!1}},[a("Form",{ref:"formValidate",staticClass:"form-box",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":110}},[a("FormItem",{attrs:{label:"相册名称：",prop:"name"}},[a("Input",{attrs:{placeholder:"请输入相册名称"},model:{value:t.formValidate.name,callback:function(e){t.$set(t.formValidate,"name",e)},expression:"formValidate.name"}})],1),a("FormItem",{attrs:{label:"是否设置密码："}},[a("RadioGroup",{on:{"on-change":t.changeStatusEvent},model:{value:t.isSwitch,callback:function(e){t.isSwitch=e},expression:"isSwitch"}},[a("Radio",{attrs:{label:"yes"}},[t._v("是")]),a("Radio",{attrs:{label:"no"}},[t._v("否")])],1)],1),a("FormItem",{directives:[{name:"show",rawName:"v-show",value:"yes"==t.isSwitch,expression:"isSwitch == 'yes'"}],attrs:{label:"相册密码：",prop:"pass"}},[a("Input",{attrs:{placeholder:"请输入相册密码"},model:{value:t.formValidate.pass,callback:function(e){t.$set(t.formValidate,"pass",e)},expression:"formValidate.pass"}})],1),a("FormItem",{attrs:{label:"活动类型：",prop:"type_id"}},[a("Select",{attrs:{placeholder:"请选择活动类型"},model:{value:t.formValidate.type_id,callback:function(e){t.$set(t.formValidate,"type_id",e)},expression:"formValidate.type_id"}},t._l(t.activityType,(function(e){return a("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),a("FormItem",{attrs:{label:"活动日期：",prop:"dateRange"}},[a("DatePicker",{staticStyle:{width:"100%"},attrs:{format:"yyyy-MM-dd",type:"daterange",placeholder:"请选择活动日期"},on:{"on-change":t.setTimeEvent},model:{value:t.formValidate.dateRange,callback:function(e){t.$set(t.formValidate,"dateRange",e)},expression:"formValidate.dateRange"}})],1),a("FormItem",{attrs:{label:"活动地点：",prop:"city",placeholder:"请选择活动地点"}},[t.cityJson.length?a("Cascader",{attrs:{data:t.cityJson},model:{value:t.formValidate.city,callback:function(e){t.$set(t.formValidate,"city",e)},expression:"formValidate.city"}}):t._e()],1),a("FormItem",{attrs:{label:"详细地址：",prop:"address"}},[a("Input",{attrs:{placeholder:"请填写详细地址"},model:{value:t.formValidate.address,callback:function(e){t.$set(t.formValidate,"address",e)},expression:"formValidate.address"}})],1),a("FormItem",{attrs:{label:"活动介绍：",prop:"desc"}},[a("Input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"请填写活动介绍"},model:{value:t.formValidate.desc,callback:function(e){t.$set(t.formValidate,"desc",e)},expression:"formValidate.desc"}})],1),a("FormItem",[a("Button",{attrs:{type:"primary",loading:t.loading},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t.loading?a("span",[t._v("正在提交...")]):a("span",[t._v("立即创建")])])],1)],1)],1)}),[],!1,null,"ad5fcc36",null).exports,n={data:function(){return{loading:!0,shareQrcodeModal:!1,shareUrl:"",isShowPhotoUpdate:!1,photoUpdateData:{},tableHead:[{type:"index",width:55,title:"编号",align:"center",sortable:!0},{title:"相册名称",align:"center",key:"name",minWidth:100,slot:"photo_name"},{title:"日期",align:"center",slot:"createtime",sortable:!0,minWidth:100},{title:"举办城市",align:"center",key:"city",slot:"city",minWidth:120},{title:"详细地址",align:"center",key:"address",minWidth:100},{title:"照片数",align:"center",minWidth:60,key:"photo_number"},{title:"点击数",align:"center",minWidth:70,key:"look",sortable:!0},{title:"图片下载",align:"center",minWidth:80,key:"is_down_src",slot:"is_down_src"},{title:"水印图下载",align:"center",minWidth:80,key:"is_down_waterSrc",slot:"is_down_waterSrc"},{title:"水印状态",align:"center",minWidth:70,key:"show_image_type",slot:"show_image_type"},{title:"状态",align:"center",minWidth:80,key:"status",slot:"status"},{title:"操作",align:"center",minWidth:260,key:"edit",slot:"action"}],tableBody:[],totalCount:0,page:{page:1,limit:30},searchName:""}},components:{shareQrcode:a("78ae").a,photoUpdate:r},computed:{filterTable:function(){var t=this,e=this.tableBody;return""==this.searchName?e:e.filter((function(e){return e.name&&e.name.like(t.searchName)}))}},methods:{showQrcodeEvent:function(t){this.shareQrcodeModal=!0,this.shareUrl=this.mUrl+"#/pages/preview-image/preview-image?id="+t},changePage:function(t){this.page.page=t,this.getPhotoList()},statusChangeEvent:function(t,e,a){var o=this;"status"==a?this.getIsPictureList(t.id).then((function(i){i?o.changePhotoStatus(t,e,a):o.$set(o.tableBody[t._index],"type",0)})):this.changePhotoStatus(t,e,a)},changePhotoStatus:function(t,e,a){var o=this,i={id:t.id};i[a]=e?1:0,this.$req.photoliveCreateUpdate(i).then((function(t){1e5==t.code?o.$Message.success(t.message):o.$Message.error(t.message)})).catch((function(t){console.log(t),o.$Message.error("系统异常")}))},getIsPictureList:function(t){var e=this;return new Promise((function(a,o){e.$req.phonelivePictureList({project_id:t,status:0},{loading:!1}).then((function(t){1e5==t.code?t.data?a(!0):(e.$Message.warning("您相册中还没有图片，不允许上架"),a(!1)):(e.$Message.error(t.message),a(!1))})).catch((function(t){console.log(t),a(!1),e.$Message.error("系统异常")}))}))},setNameEvent:function(t,e){this[t]=e},createPhotoFun:function(t){this.photoUpdateData=t,this.isShowPhotoUpdate=!0},getPhotoList:function(){var t=this;this.$req.photoliveList(Object(o.a)({u_id:this.$userinfo.id},this.page),{loading:!1}).then((function(e){1e5==e.code&&(t.$req.getCitys().then((function(t){e.data.forEach((function(e){var a=t.findItem({value:e.province_id}),o=a.children.findItem({value:e.city_id}),i=o.children.findItem({value:e.area_id});e.province=a.label,e.city=o.label,e.area=i.label}))})),t.tableBody=e.data,t.totalCount=parseInt(e.count)),t.loading=!1})).catch((function(e){console.log(e),t.$Message.error("系统异常"),t.loading=!1}))},deletePhotoFun:function(t){var e=this;this.$Modal.confirm({title:"警告提示",content:"如果删除当前相册，则会删除此相册下所有配置数据，不可回退，是否确定删除？",okText:"确定",cancelText:"取消",closable:!0,onOk:function(){e.$req.photoliveDelete({id:t.id}).then((function(a){1e5==a.code?(e.tableBody.splice(t._index,1),e.$req.delDir({dir:e.$userinfo.id+"/"+t.id}).then((function(t){1e5==t.code&&e.$Message.success("数据清理完成")})),e.$Message.success(a.message)):e.$Message.error(a.message)})).catch((function(t){console.log(t),e.$Message.error("系统异常")}))}})},payBtnEvent:function(t){var e=this;this.$req.photoOrderOne({project_id:t,no_other:!0}).then((function(a){1e5==a.code&&(a.data?e.$router.push({name:"BuyDetails",params:{project_id:t}}):e.$router.push({name:"BuyList",params:{project_id:t}}))})).catch((function(t){console.log(t),e.$Message.error("系统异常")}))}},created:function(){this.getPhotoList()}},l=(a("7ab8"),Object(s.a)(n,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"photo-list"},[a("Row",[a("Col",{attrs:{type:"flex",span:"12"}},[a("Input",{staticStyle:{width:"auto"},attrs:{placeholder:"输入相册名称搜索"},model:{value:t.searchName,callback:function(e){t.searchName=e},expression:"searchName"}},[a("Icon",{attrs:{slot:"suffix",type:"ios-search"},slot:"suffix"})],1),a("p",{staticStyle:{color:"#f00"}},[t._v("如果您已配置水印并且水印状态开启后则前台显示带水印的图片")])],1),a("Col",{staticClass:"t-r",attrs:{span:"12"}},[a("Button",{attrs:{type:"info"},on:{click:function(e){return t.createPhotoFun({})}}},[t._v("创建相册")])],1)],1),a("Table",{staticClass:"mt20",attrs:{loading:t.loading,"highlight-row":"",columns:t.tableHead,data:t.filterTable},scopedSlots:t._u([{key:"photo_name",fn:function(e){var o=e.row;return[a("router-link",{attrs:{to:{name:"CaseDetails",params:{case_id:o.id,pass:o.pass}}}},[t._v(t._s(o.name))])]}},{key:"createtime",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.starttime)+" 至 "+t._s(a.endtime)+" ")]}},{key:"city",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.province)),t._v(" - "+t._s(a.area)+" ")]}},{key:"status",fn:function(e){var o=e.row;return[a("i-switch",{attrs:{value:1==o.status,size:"large"},on:{"on-change":function(e){return t.statusChangeEvent(o,e,"status")}}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("公开")]),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("私有")])])]}},{key:"is_down_src",fn:function(e){var o=e.row;return[a("i-switch",{attrs:{value:1==o.is_down_src,size:"large"},on:{"on-change":function(e){return t.statusChangeEvent(o,e,"is_down_src")}}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("允许")]),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("禁止")])])]}},{key:"is_down_waterSrc",fn:function(e){var o=e.row;return[o.photoWater?a("i-switch",{attrs:{value:1==o.is_down_waterSrc,size:"large"},on:{"on-change":function(e){return t.statusChangeEvent(o,e,"is_down_waterSrc")}}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("允许")]),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("禁止")])]):t._e()]}},{key:"show_image_type",fn:function(e){var o=e.row;return[o.photoWater?a("i-switch",{attrs:{value:1==o.show_image_type,size:"large"},on:{"on-change":function(e){return t.statusChangeEvent(o,e,"show_image_type")}}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("显示")]),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("隐藏")])]):t._e()]}},{key:"action",fn:function(e){var o=e.row;return[o.photoOrder&&1==o.photoOrder.status?[a("Button",{staticClass:"table-btn",staticStyle:{"margin-right":"3px"},attrs:{size:"small"},on:{click:function(e){return t.showQrcodeEvent(o.id)}}},[t._v("分享")]),a("Button",{staticClass:"table-btn",staticStyle:{"margin-right":"3px"},attrs:{to:{name:"PhotoGroup",params:{project_id:o.id}},type:"primary",size:"small"}},[t._v("设置")]),a("Button",{staticClass:"table-btn",staticStyle:{"margin-right":"3px"},attrs:{to:{name:"UploadImage",params:{project_id:o.id}},type:"primary",size:"small"}},[t._v("上传照片")])]:o.photoOrder&&2==o.photoOrder.status?a("Button",{staticClass:"table-btn",staticStyle:{color:"#666"},attrs:{disabled:"",size:"small"}},[t._v("已过期")]):a("Button",{staticClass:"table-btn",staticStyle:{"margin-right":"3px"},attrs:{size:"small",type:"primary"},on:{click:function(e){return t.payBtnEvent(o.id)}}},[t._v("去付款")]),o.photoOrder&&2!=o.photoOrder.status?a("Button",{staticClass:"table-btn",staticStyle:{"margin-right":"3px"},attrs:{size:"small",type:"warning"},on:{click:function(e){return t.createPhotoFun(o)}}},[t._v("编辑")]):t._e(),a("Button",{staticClass:"table-btn",attrs:{type:"error",size:"small"},on:{click:function(e){return t.deletePhotoFun(o)}}},[t._v("删除")])]}}])}),t.totalCount>t.page.limit?a("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.totalCount,"page-size":t.page.limit,current:t.page.page},on:{"on-change":t.changePage}})],1)]):t._e(),a("Modal",{attrs:{"footer-hide":"",title:"创建相册"},model:{value:t.isShowPhotoUpdate,callback:function(e){t.isShowPhotoUpdate=e},expression:"isShowPhotoUpdate"}},[a("photo-update",{attrs:{photoUpdateData:t.photoUpdateData},on:{setNameEvent:t.setNameEvent,getPhotoList:t.getPhotoList}})],1),a("share-qrcode",{attrs:{shareQrcodeModal:t.shareQrcodeModal,shareUrl:t.shareUrl},on:{setNameEvent:t.setNameEvent}})],1)}),[],!1,null,"749c5fc6",null));e.default=l.exports},"7ab8":function(t,e,a){"use strict";var o=a("0379");a.n(o).a},9852:function(t,e,a){},a9bf:function(t,e,a){"use strict";var o=a("9852");a.n(o).a},c451:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));a("f3dd"),a("dbb3"),a("fe59"),a("b73f"),a("bf84"),a("fe8a"),a("08ba");var o=a("b081");function i(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function s(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?i(Object(a),!0).forEach((function(e){Object(o.a)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}},db23:function(t,e,a){function o(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=o=function(t){return typeof t}:t.exports=o=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(e)}a("f3dd"),a("0a51"),a("9b11"),a("a133"),a("e18c"),a("96db"),a("af86"),t.exports=o}}]);