(window.webpackJsonp=window.webpackJsonp||[]).push([["PhotoAudio"],{"440f":function(t,e,a){"use strict";a.r(e);a("dbb3"),a("fe59"),a("ea69"),a("053b"),a("e35a"),a("0d7a"),a("08ba");var o={name:"setPhotoGroup",data:function(){return{audioSrc:"",audioList:[],loading:!0,uploadAudioSelectModal:!1,isAudioSelected:!1,audioName:"",random:"0",uploadLoading:!1,tableHead:[{width:60,key:"checkbox",align:"center",slot:"checkbox"},{key:"id",width:100,title:"编号",align:"center",sortable:!0},{title:"音频名称",align:"center",key:"name",minWidth:100},{title:"日期",align:"center",key:"createtime",sortable:!0,minWidth:120},{title:"音频",align:"center",slot:"audio",width:100}],tableBody:[],totalCount:0,page:{page:1,limit:30},searchName:""}},watch:{tableBody:{handler:function(t,e){this.audioList=t.filter((function(t){return t._checked})),this.audioList.sort((function(t,e){return t.index-e.index}))},deep:!0}},components:{},methods:{onDragDrop:function(t,e){t=parseInt(t),e=parseInt(e);var a=this.audioList[t];if(t<e){for(var o=t+1;o<=e;o++)this.audioList.splice(o-1,1,this.audioList[o]);this.audioList.splice(e,1,a)}if(t>e){for(o=t;o>e;o--)this.audioList.splice(o,1,this.audioList[o-1]);this.audioList.splice(e,1,a)}},handleEventPlay:function(t,e){var a=this;e.forEach((function(t){a.$set(t,"play",!1)})),this.$set(e[t._index],"play",!0),this.audioSrc=t.src},handleEventPause:function(t,e){this.$set(e[t._index],"play",!1),this.audioSrc=""},confirmSortEvent:function(){this.insertUpdateSetting(),this.isAudioSelected=!1},insertUpdateSetting:function(){var t=this,e={project_id:this.$route.params.project_id,audio_id:"",random:this.random};this.audioList.forEach((function(t){e.audio_id+=t.id+","})),e.audio_id=e.audio_id.substr(0,e.audio_id.length-1),this.$req.photoliveAudioCreateUpdate(e,{loading:!1}).then((function(e){1e5==e.code?t.$Message.success(e.message):t.$Message.error(e.message)})).catch((function(e){console.log(e),t.$Message.error("系统异常")}))},checkboxEvent:function(t){this.tableBody[t._index]._checked=!t._checked},uploadImageBeforeEvent:function(t){this.uploadLoading=!0},uploadImageProgressEvent:function(t,e,a){},handleMaxSize:function(t){this.$Notice.warning({title:"超出文件大小限制",desc:"文件  "+t.name+" 过大, 文件大小不能超过20M"}),this.uploadLoading=!1},uploadImageSuccessEvent:function(t,e){var a=this;if(1e5==t.code){var o={src:t.data.fileSrc,name:this.audioName||"未知"};this.$req.photoliveAudioInsert(o,{loading:!1}).then((function(e){1e5==e.code?(e.data.src=a.$oss+e.data.src,e.data.status=!1,e.data.play=!1,e.data._checked=!1,a.tableBody.unshift(e.data)):a.$Message.error(t.message),a.audioName=""})).catch((function(t){console.log(t),a.$Message.error("系统异常")}))}else this.$Message.error(t.message);this.uploadLoading=!1,this.uploadAudioSelectModal=!1},uploadImageErrorEvent:function(t,e,a){this.$Notice.warning({title:"文件格式不正确",desc:e.name+"格式不正确，请选择.wav,.mp3,.wma。"}),this.uploadLoading=!1},photoliveAudioList:function(){var t=this;this.$req.photoliveAudioList({name:this.searchName}).then((function(e){1e5==e.code?t.photoliveAudioSetting((function(a){e.data.forEach((function(e){if(e.status=!1,e.play=!1,e.src=t.$oss+e.src,e._checked=!1,a.audio_id)for(var o=a.audio_id.split(","),i=0,s=o.length;i<s;i++)if(o[i]==e.id){e._checked=!0,e.index=i;break}})),t.tableBody=e.data,t.totalCount=parseInt(e.count)})):t.$Message.error(e.message),t.loading=!1})).catch((function(){t.$Message.error("服务器内部错误"),t.loading=!1}))},photoliveAudioSetting:function(t){var e=this;this.$req.photoliveAudioSetting(this.$route.params,{loading:!1}).then((function(a){1e5==a.code?t(a.data||{}):(t({}),e.$Message.error(a.message))})).catch((function(a){console.log(a),t({}),e.$Message.error("系统异常")}))}},created:function(){this.photoliveAudioList()}},i=(a("635c"),a("e90a")),s=Object(i.a)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"setPhotoGroup",staticStyle:{"margin-top":"25px"}},[a("Card",{attrs:{"dis-hover":"",bordered:!1}},[a("p",{staticStyle:{"line-height":"33px",height:"30px"},attrs:{slot:"title"},slot:"title"},[a("Icon",{staticStyle:{"font-size":"20px"},attrs:{type:"ios-browsers"}}),t._v(" 设置相册音频 "),a("span",{staticStyle:{color:"#f00","margin-left":"15px"}},[t._v("不选则是不设置音频")])],1),a("Button",{attrs:{slot:"extra",name:"btn",type:"primary"},on:{click:function(e){t.uploadAudioSelectModal=!0}},slot:"extra"},[t._v("上传音频")]),t.audioSrc?a("audio",{attrs:{autoplay:"autoplay",src:t.audioSrc}},[t._v("您的浏览器暂不支持播放，请更新浏览器")]):t._e()],1),a("Row",[a("Col",{attrs:{type:"flex",span:"12"}},[a("Input",{staticStyle:{width:"auto"},attrs:{placeholder:"输入音频名称搜索"},model:{value:t.searchName,callback:function(e){t.searchName=e},expression:"searchName"}},[a("Icon",{attrs:{slot:"suffix",type:"ios-search"},slot:"suffix"})],1),a("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:t.photoliveAudioList}},[t._v("搜 索")])],1)],1),a("Table",{staticClass:"mt20",attrs:{loading:t.loading,"disabled-hover":"",columns:t.tableHead,data:t.tableBody},scopedSlots:t._u([{key:"audio",fn:function(e){var o=e.row;return[a("div",{staticClass:"flex x-center"},[o.play?a("Icon",{attrs:{type:"md-pause"},on:{click:function(e){return t.handleEventPause(o,t.tableBody)}}}):a("Icon",{staticClass:"icon-play flex x-center y-center",attrs:{type:"md-play"},on:{click:function(e){return t.handleEventPlay(o,t.tableBody)}}})],1)]}},{key:"checkbox",fn:function(e){var o=e.row;return[a("Checkbox",{directives:[{name:"show",rawName:"v-show",value:t.audioList.length<5||o._checked,expression:"audioList.length < 5 || row._checked"}],on:{"on-change":function(e){return t.checkboxEvent(o)}},model:{value:1==o._checked,callback:function(e){t.$set(o,"_checked == true",e)},expression:"row._checked == true"}})]}}])}),a("div",{staticStyle:{margin:"10px"}},[a("Form",{attrs:{"label-width":80}},[a("FormItem",{attrs:{label:"播放顺序"}},[a("RadioGroup",{model:{value:t.random,callback:function(e){t.random=e},expression:"random"}},[a("Radio",{attrs:{label:"0"}},[a("span",[t._v("顺序播放")])]),a("Radio",{attrs:{label:"1"}},[a("span",[t._v("随机播放")])])],1)],1)],1)],1),a("div",{staticClass:"flex x-between",staticStyle:{margin:"10px","margin-bottom":"120px",overflow:"hidden"}},[a("Button",{staticStyle:{width:"120px"},attrs:{type:"primary"},on:{click:t.insertUpdateSetting}},[t._v("提 交")]),t.totalCount>t.page.limit?a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.totalCount,"page-size":t.page.limit,current:t.page.page},on:{"on-change":t.changePage}})],1):t._e()],1),a("Modal",{staticClass:"uploadImageSelect",attrs:{width:"80%",height:"80%"},model:{value:t.isAudioSelected,callback:function(e){t.isAudioSelected=e},expression:"isAudioSelected"}},[a("p",{staticStyle:{display:"block"},attrs:{slot:"header"},slot:"header"},[a("span",[t._v("已选列表")])]),a("div",{staticStyle:{width:"80%","min-height":"400px",margin:"0 auto","padding-bottom":"30px"}},[a("Table",{ref:"selection",staticClass:"mt20",attrs:{draggable:!0,loading:t.loading,"disabled-hover":"",columns:t.tableHead,data:t.audioList},on:{"on-drag-drop":t.onDragDrop},scopedSlots:t._u([{key:"audio",fn:function(e){var o=e.row;return[a("div",{staticClass:"flex x-center"},[o.play?a("Icon",{attrs:{type:"md-pause"},on:{click:function(e){return t.handleEventPause(o,t.audioList)}}}):a("Icon",{staticClass:"icon-play flex x-center y-center",attrs:{type:"md-play"},on:{click:function(e){return t.handleEventPlay(o,t.audioList)}}})],1)]}},{key:"checkbox",fn:function(t){t.row;return[a("Icon",{attrs:{type:"md-move"}})]}}])})],1),a("div",{staticClass:"flex x-right",attrs:{slot:"footer"},slot:"footer"},[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"default"},on:{click:function(e){t.isAudioSelected=!1}}},[t._v("取消")]),a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary"},on:{click:t.confirmSortEvent}},[t._v("确定")])],1)]),a("Modal",{staticClass:"uploadImageSelect",attrs:{width:"420"},model:{value:t.uploadAudioSelectModal,callback:function(e){t.uploadAudioSelectModal=e},expression:"uploadAudioSelectModal"}},[a("p",{staticStyle:{display:"block"},attrs:{slot:"header"},slot:"header"},[a("span",[t._v("上传音频")])]),a("div",{staticStyle:{width:"80%",margin:"0 auto","padding-bottom":"30px"}},[a("Form",{staticClass:"photoUploadConfig",staticStyle:{"margin-top":"20px"},attrs:{model:t.configCurrentObject,"label-width":70}},[a("FormItem",{attrs:{label:"音乐名称"}},[a("Input",{attrs:{type:"text"},model:{value:t.audioName,callback:function(e){t.audioName=e},expression:"audioName"}}),a("p",{staticStyle:{color:"#f00"}},[t._v("音乐名称前台会显示哦...,请认真填写")])],1)],1)],1),a("div",{staticClass:"flex x-right",attrs:{slot:"footer"},slot:"footer"},[a("Button",{staticStyle:{"margin-right":"5px"},on:{click:function(e){t.uploadAudioSelectModal=!1}}},[t._v("取消")]),t.uploadLoading?a("Button",[t._v("上传中,请稍后...")]):a("Upload",{ref:"upload",attrs:{"max-size":20480,"show-upload-list":!1,"on-exceeded-size":t.handleMaxSize,accept:".wav,.mp3,.wma,.m4a",format:["wav","mp3","wma","m4a"],"before-upload":t.uploadImageBeforeEvent,"on-success":t.uploadImageSuccessEvent,"on-error":t.uploadImageErrorEvent,"on-progress":t.uploadImageProgressEvent,data:{dir:"audio"},action:t.$req.uploadImage()}},[a("Button",{attrs:{type:"primary"}},[t._v("上传音频")])],1)],1)]),a("Badge",{staticClass:"buy-car-icon",attrs:{count:t.audioList.length}},[a("Button",{attrs:{size:"large",type:"primary",shape:"circle"},on:{click:function(e){t.isAudioSelected=!0}}},[t._v("已选列表")])],1)],1)}),[],!1,null,"1901a640",null);e.default=s.exports},"635c":function(t,e,a){"use strict";var o=a("d84d");a.n(o).a},d84d:function(t,e,a){}}]);